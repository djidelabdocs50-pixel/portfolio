<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CipherArena â€” CTF Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#080c10;
  --bg2:#0d1117;
  --bg3:#111820;
  --card:#0f1923;
  --border:#1e3a4a;
  --accent:#00e5ff;
  --accent2:#00ff9d;
  --accent3:#ff4757;
  --warn:#ffa502;
  --text:#c8e6f0;
  --muted:#4a7a8a;
  --easy:#00ff9d;
  --medium:#ffa502;
  --hard:#ff4757;
  --mono:'Share Tech Mono',monospace;
  --sans:'Rajdhani',sans-serif;
}
html,body{min-height:100vh;background:var(--bg);color:var(--text);font-family:var(--sans);overflow-x:hidden;}

/* scanline overlay */
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,229,255,0.015) 2px,rgba(0,229,255,0.015) 4px);pointer-events:none;z-index:9999;}

/* grid bg */
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.03) 1px,transparent 1px);background-size:50px 50px;z-index:0;}

/* â”€â”€ SCREENS â”€â”€ */
.screen{position:relative;z-index:1;display:none;}
.screen.active{display:block;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTRO SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#intro-screen{min-height:100vh;display:none;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:40px 20px;}
#intro-screen.active{display:flex;}

.glitch-title{
  font-family:var(--mono);
  font-size:clamp(36px,8vw,80px);
  color:var(--accent);
  text-shadow:0 0 20px rgba(0,229,255,0.5),0 0 40px rgba(0,229,255,0.3);
  letter-spacing:0.1em;
  position:relative;
  animation:flicker 4s infinite;
}
@keyframes flicker{0%,95%,100%{opacity:1}96%{opacity:0.8}97%{opacity:1}98%{opacity:0.6}99%{opacity:1}}

.glitch-title::before,.glitch-title::after{
  content:attr(data-text);
  position:absolute;left:0;top:0;width:100%;
}
.glitch-title::before{color:#ff4757;animation:glitch1 3s infinite;clip-path:polygon(0 0,100% 0,100% 45%,0 45%);}
.glitch-title::after{color:#00ff9d;animation:glitch2 3s infinite;clip-path:polygon(0 55%,100% 55%,100% 100%,0 100%);}
@keyframes glitch1{0%,90%,100%{transform:translate(0)}92%{transform:translate(-3px,1px)}94%{transform:translate(3px,-1px)}96%{transform:translate(-2px,2px)}}
@keyframes glitch2{0%,90%,100%{transform:translate(0)}91%{transform:translate(3px,-1px)}93%{transform:translate(-3px,2px)}95%{transform:translate(2px,-2px)}}

.tagline{font-family:var(--mono);font-size:14px;color:var(--muted);letter-spacing:0.2em;text-transform:uppercase;margin:16px 0 48px;}

.callsign-form{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%;max-width:400px;}
.callsign-label{font-family:var(--mono);font-size:12px;color:var(--accent);letter-spacing:0.15em;align-self:flex-start;}

.callsign-input{
  width:100%;background:var(--card);
  border:1px solid var(--border);border-radius:4px;
  color:var(--accent);font-family:var(--mono);font-size:18px;
  padding:14px 18px;outline:none;
  transition:border-color 0.2s,box-shadow 0.2s;
  letter-spacing:0.1em;
}
.callsign-input:focus{border-color:var(--accent);box-shadow:0 0 20px rgba(0,229,255,0.15);}
.callsign-input::placeholder{color:var(--muted);}

.btn-enter{
  width:100%;padding:14px;
  background:transparent;
  border:1px solid var(--accent);border-radius:4px;
  color:var(--accent);font-family:var(--mono);font-size:14px;
  letter-spacing:0.2em;cursor:pointer;
  transition:all 0.2s;text-transform:uppercase;
  position:relative;overflow:hidden;
}
.btn-enter::before{content:'';position:absolute;inset:0;background:var(--accent);transform:translateX(-100%);transition:transform 0.2s;z-index:-1;}
.btn-enter:hover{color:var(--bg);box-shadow:0 0 30px rgba(0,229,255,0.3);}
.btn-enter:hover::before{transform:translateX(0);}

.stats-row{display:flex;gap:40px;margin-top:60px;}
.stat{text-align:center;}
.stat-num{font-family:var(--mono);font-size:28px;color:var(--accent);display:block;}
.stat-label{font-family:var(--mono);font-size:10px;color:var(--muted);letter-spacing:0.15em;text-transform:uppercase;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN ARENA SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#arena-screen{min-height:100vh;}

/* Header */
.arena-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:16px 40px;
  background:rgba(8,12,16,0.95);
  border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:100;
  backdrop-filter:blur(10px);
}
.arena-logo{font-family:var(--mono);font-size:16px;color:var(--accent);letter-spacing:0.1em;}
.arena-logo span{color:var(--muted);}
.player-info{display:flex;align-items:center;gap:20px;}
.player-callsign{font-family:var(--mono);font-size:13px;color:var(--accent2);}
.player-score{font-family:var(--mono);font-size:20px;color:var(--accent);font-weight:bold;}
.score-label{font-size:11px;color:var(--muted);display:block;text-align:right;}

/* Nav tabs */
.arena-nav{
  display:flex;gap:0;
  border-bottom:1px solid var(--border);
  padding:0 40px;
  background:var(--bg2);
}
.nav-tab{
  font-family:var(--mono);font-size:12px;letter-spacing:0.1em;
  padding:14px 24px;border:none;background:transparent;
  color:var(--muted);cursor:pointer;
  border-bottom:2px solid transparent;
  transition:all 0.2s;text-transform:uppercase;
}
.nav-tab.active{color:var(--accent);border-bottom-color:var(--accent);}
.nav-tab:hover:not(.active){color:var(--text);}

/* Tab content */
.tab-content{display:none;padding:40px;}
.tab-content.active{display:block;}

/* â”€â”€ CHALLENGES TAB â”€â”€ */
.challenges-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:20px;
  max-width:1200px;margin:0 auto;
}

.challenge-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:6px;
  padding:24px;
  cursor:pointer;
  transition:all 0.25s;
  position:relative;
  overflow:hidden;
}
.challenge-card::before{
  content:'';position:absolute;top:0;left:0;
  width:3px;height:100%;
}
.challenge-card.easy::before{background:var(--easy);}
.challenge-card.medium::before{background:var(--medium);}
.challenge-card.hard::before{background:var(--hard);}

.challenge-card:hover{
  border-color:var(--accent);
  transform:translateY(-3px);
  box-shadow:0 8px 30px rgba(0,229,255,0.1);
}
.challenge-card.solved{
  border-color:rgba(0,255,157,0.3);
  background:rgba(0,255,157,0.03);
}
.challenge-card.solved::after{
  content:'âœ“ SOLVED';
  position:absolute;top:12px;right:12px;
  font-family:var(--mono);font-size:10px;
  color:var(--easy);letter-spacing:0.1em;
  background:rgba(0,255,157,0.1);
  padding:3px 8px;border-radius:2px;
  border:1px solid rgba(0,255,157,0.2);
}

.ch-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:12px;}
.ch-title{font-family:var(--sans);font-size:18px;font-weight:700;color:var(--text);line-height:1.2;}
.ch-points{font-family:var(--mono);font-size:22px;font-weight:bold;}
.challenge-card.easy .ch-points{color:var(--easy);}
.challenge-card.medium .ch-points{color:var(--medium);}
.challenge-card.hard .ch-points{color:var(--hard);}

.ch-desc{font-size:14px;color:var(--muted);line-height:1.6;margin-bottom:16px;}
.ch-tags{display:flex;gap:8px;flex-wrap:wrap;}
.ch-tag{
  font-family:var(--mono);font-size:10px;letter-spacing:0.08em;
  padding:3px 8px;border-radius:2px;
  background:rgba(0,229,255,0.05);
  border:1px solid var(--border);
  color:var(--muted);text-transform:uppercase;
}
.diff-badge{
  font-family:var(--mono);font-size:10px;letter-spacing:0.1em;
  padding:3px 10px;border-radius:2px;text-transform:uppercase;
}
.easy .diff-badge{color:var(--easy);background:rgba(0,255,157,0.08);border:1px solid rgba(0,255,157,0.2);}
.medium .diff-badge{color:var(--medium);background:rgba(255,165,2,0.08);border:1px solid rgba(255,165,2,0.2);}
.hard .diff-badge{color:var(--hard);background:rgba(255,71,87,0.08);border:1px solid rgba(255,71,87,0.2);}

/* â”€â”€ CHALLENGE MODAL â”€â”€ */
.modal-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.85);
  z-index:200;
  display:none;align-items:center;justify-content:center;
  padding:20px;
  backdrop-filter:blur(4px);
}
.modal-overlay.open{display:flex;}

.modal{
  background:var(--bg2);
  border:1px solid var(--border);
  border-radius:8px;
  width:100%;max-width:680px;
  max-height:90vh;overflow-y:auto;
  animation:modalIn 0.2s ease;
}
@keyframes modalIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}

.modal-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 24px;
  border-bottom:1px solid var(--border);
  position:sticky;top:0;background:var(--bg2);z-index:1;
}
.modal-title{font-family:var(--sans);font-size:20px;font-weight:700;color:var(--text);}
.modal-close{
  background:transparent;border:none;
  color:var(--muted);font-size:20px;cursor:pointer;
  transition:color 0.2s;font-family:var(--mono);
}
.modal-close:hover{color:var(--accent3);}

.modal-body{padding:24px;}

.challenge-desc-full{
  font-size:15px;color:var(--text);line-height:1.8;
  margin-bottom:24px;
}

.cipher-box{
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:4px;
  padding:20px;
  font-family:var(--mono);font-size:14px;
  color:var(--accent);
  letter-spacing:0.05em;
  line-height:1.8;
  margin-bottom:24px;
  word-break:break-all;
  position:relative;
}
.cipher-label{
  font-family:var(--mono);font-size:10px;
  color:var(--muted);letter-spacing:0.15em;
  text-transform:uppercase;
  margin-bottom:8px;
}

.answer-row{display:flex;gap:12px;margin-bottom:16px;}
.answer-input{
  flex:1;background:var(--card);
  border:1px solid var(--border);border-radius:4px;
  color:var(--text);font-family:var(--mono);font-size:15px;
  padding:12px 16px;outline:none;
  transition:border-color 0.2s;
}
.answer-input:focus{border-color:var(--accent);}
.answer-input.correct{border-color:var(--easy);background:rgba(0,255,157,0.05);}
.answer-input.wrong{border-color:var(--hard);animation:shake 0.3s ease;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}

.btn-submit{
  padding:12px 24px;
  background:var(--accent);color:var(--bg);
  border:none;border-radius:4px;
  font-family:var(--mono);font-size:13px;font-weight:bold;
  letter-spacing:0.1em;cursor:pointer;
  transition:all 0.2s;white-space:nowrap;
}
.btn-submit:hover{background:#33eeff;box-shadow:0 0 20px rgba(0,229,255,0.4);}
.btn-submit:disabled{opacity:0.4;cursor:not-allowed;}

.feedback{
  font-family:var(--mono);font-size:13px;
  padding:10px 16px;border-radius:4px;
  margin-bottom:16px;display:none;
}
.feedback.show{display:block;}
.feedback.correct{color:var(--easy);background:rgba(0,255,157,0.08);border:1px solid rgba(0,255,157,0.2);}
.feedback.wrong{color:var(--hard);background:rgba(255,71,87,0.08);border:1px solid rgba(255,71,87,0.2);}

/* AI Hint */
.hint-section{margin-top:20px;border-top:1px solid var(--border);padding-top:20px;}
.btn-hint{
  display:flex;align-items:center;gap:8px;
  background:transparent;
  border:1px solid var(--border);border-radius:4px;
  color:var(--muted);font-family:var(--mono);font-size:12px;
  letter-spacing:0.1em;padding:10px 16px;cursor:pointer;
  transition:all 0.2s;text-transform:uppercase;
  margin-bottom:12px;
}
.btn-hint:hover{border-color:var(--warn);color:var(--warn);}

.hint-box{
  background:var(--bg);border:1px solid rgba(255,165,2,0.2);
  border-radius:4px;padding:16px;
  font-size:14px;color:var(--text);line-height:1.7;
  display:none;
}
.hint-box.show{display:block;}
.hint-loading{color:var(--warn);font-family:var(--mono);font-size:12px;letter-spacing:0.1em;animation:pulse 1s infinite;}
@keyframes pulse{0%,100%{opacity:0.4}50%{opacity:1}}

/* â”€â”€ SCOREBOARD TAB â”€â”€ */
.scoreboard{max-width:700px;margin:0 auto;}
.score-header-row{
  display:grid;grid-template-columns:60px 1fr 120px 100px;
  padding:12px 20px;
  font-family:var(--mono);font-size:11px;
  color:var(--muted);letter-spacing:0.1em;
  text-transform:uppercase;
  border-bottom:1px solid var(--border);
}
.score-row{
  display:grid;grid-template-columns:60px 1fr 120px 100px;
  padding:14px 20px;
  border-bottom:1px solid rgba(30,58,74,0.5);
  transition:background 0.15s;
  align-items:center;
}
.score-row:hover{background:rgba(0,229,255,0.03);}
.score-row.you{background:rgba(0,229,255,0.05);border-left:2px solid var(--accent);}
.rank{font-family:var(--mono);font-size:14px;color:var(--muted);}
.rank.gold{color:#ffd700;font-weight:bold;}
.rank.silver{color:#c0c0c0;}
.rank.bronze{color:#cd7f32;}
.sb-name{font-family:var(--sans);font-size:16px;font-weight:600;color:var(--text);}
.sb-solved{font-family:var(--mono);font-size:13px;color:var(--muted);}
.sb-score{font-family:var(--mono);font-size:18px;color:var(--accent);font-weight:bold;text-align:right;}

/* empty scoreboard */
.empty-board{
  text-align:center;padding:60px;
  font-family:var(--mono);font-size:13px;
  color:var(--muted);letter-spacing:0.08em;
}

/* â”€â”€ TERMINAL TAB â”€â”€ */
.terminal-wrap{
  max-width:800px;margin:0 auto;
  background:var(--bg);
  border:1px solid var(--border);border-radius:6px;
  overflow:hidden;
}
.terminal-bar{
  display:flex;align-items:center;gap:8px;
  padding:10px 16px;background:var(--bg3);
  border-bottom:1px solid var(--border);
}
.t-dot{width:12px;height:12px;border-radius:50%;}
.terminal-title{font-family:var(--mono);font-size:12px;color:var(--muted);margin-left:8px;letter-spacing:0.1em;}
.terminal-body{
  padding:20px;min-height:400px;
  font-family:var(--mono);font-size:13px;
  line-height:1.8;color:var(--accent2);
}
.t-line{margin-bottom:2px;}
.t-line.cmd{color:var(--accent);}
.t-line.info{color:var(--muted);}
.t-line.success{color:var(--easy);}
.t-line.error{color:var(--hard);}
.t-line.warn{color:var(--warn);}

/* Progress bar */
.progress-section{max-width:1200px;margin:0 auto 32px;}
.progress-label{
  display:flex;justify-content:space-between;
  font-family:var(--mono);font-size:12px;color:var(--muted);
  margin-bottom:8px;letter-spacing:0.08em;
}
.progress-bar{
  height:4px;background:var(--border);border-radius:2px;overflow:hidden;
}
.progress-fill{
  height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));
  border-radius:2px;transition:width 0.5s ease;
  box-shadow:0 0 10px rgba(0,229,255,0.4);
}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:768px){
  .arena-header{padding:12px 20px;}
  .arena-nav{padding:0 20px;overflow-x:auto;}
  .tab-content{padding:20px;}
  .score-header-row,.score-row{grid-template-columns:40px 1fr 80px;}
  .sb-solved{display:none;}
}
</style>
</head>
<body>

<!-- â•â• INTRO SCREEN â•â• -->
<div id="intro-screen" class="screen active">
  <div class="glitch-title" data-text="CIPHER ARENA">CIPHER ARENA</div>
  <p class="tagline">// capture the flag Â· cybersecurity challenges</p>

  <div class="callsign-form">
    <span class="callsign-label">ENTER YOUR CALLSIGN</span>
    <input class="callsign-input" id="callsign-input" type="text" maxlength="20" placeholder="hacker_name" spellcheck="false" autocomplete="off">
    <button class="btn-enter" onclick="enterArena()">ENTER THE ARENA</button>
  </div>

  <div class="stats-row">
    <div class="stat"><span class="stat-num">6</span><span class="stat-label">Challenges</span></div>
    <div class="stat"><span class="stat-num">1400</span><span class="stat-label">Total Points</span></div>
    <div class="stat"><span class="stat-num">3</span><span class="stat-label">Difficulty Tiers</span></div>
  </div>
</div>

<!-- â•â• ARENA SCREEN â•â• -->
<div id="arena-screen" class="screen">
  <header class="arena-header">
    <div class="arena-logo">CIPHER<span>ARENA</span></div>
    <div class="player-info">
      <div class="player-callsign" id="header-callsign"></div>
      <div>
        <span class="score-label">SCORE</span>
        <div class="player-score" id="header-score">0</div>
      </div>
    </div>
  </header>

  <nav class="arena-nav">
    <button class="nav-tab active" onclick="switchTab('challenges', this)">Challenges</button>
    <button class="nav-tab" onclick="switchTab('scoreboard', this)">Scoreboard</button>
    <button class="nav-tab" onclick="switchTab('terminal', this)">Terminal</button>
  </nav>

  <!-- CHALLENGES -->
  <div class="tab-content active" id="tab-challenges">
    <div class="progress-section">
      <div class="progress-label">
        <span id="progress-text">MISSION PROGRESS</span>
        <span id="progress-pct">0%</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    </div>
    <div class="challenges-grid" id="challenges-grid"></div>
  </div>

  <!-- SCOREBOARD -->
  <div class="tab-content" id="tab-scoreboard">
    <div class="scoreboard">
      <div class="score-header-row">
        <span>#</span><span>CALLSIGN</span><span>SOLVED</span><span style="text-align:right">SCORE</span>
      </div>
      <div id="scoreboard-list"></div>
    </div>
  </div>

  <!-- TERMINAL -->
  <div class="tab-content" id="tab-terminal">
    <div class="terminal-wrap">
      <div class="terminal-bar">
        <div class="t-dot" style="background:#ff5f57"></div>
        <div class="t-dot" style="background:#febc2e"></div>
        <div class="t-dot" style="background:#28c840"></div>
        <span class="terminal-title">cipher-arena ~ activity log</span>
      </div>
      <div class="terminal-body" id="terminal-body">
        <div class="t-line info">// Welcome to CipherArena</div>
        <div class="t-line info">// Your activity will be logged here</div>
        <div class="t-line">&nbsp;</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â• CHALLENGE MODAL â•â• -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="modal-title"></div>
        <div style="display:flex;gap:10px;margin-top:6px;" id="modal-meta"></div>
      </div>
      <button class="modal-close" onclick="closeModalDirect()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="challenge-desc-full" id="modal-desc"></div>
      <div class="cipher-label" id="cipher-label">THE CIPHER</div>
      <div class="cipher-box" id="modal-cipher"></div>
      <div class="feedback" id="feedback"></div>
      <div class="answer-row">
        <input class="answer-input" id="answer-input" type="text" placeholder="Enter your answer..." spellcheck="false" autocomplete="off">
        <button class="btn-submit" id="submit-btn" onclick="submitAnswer()">SUBMIT</button>
      </div>
      <div class="hint-section">
        <button class="btn-hint" id="hint-btn" onclick="getHint()">
          <span>âš¡</span> GET AI HINT (-10 pts)
        </button>
        <div class="hint-box" id="hint-box"></div>
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHALLENGES = [
  {
    id: 1, title: "Broken Transmission", diff: "easy", points: 100,
    tags: ["CAESAR", "CIPHER"],
    desc: "Our agent intercepted a message but it appears to be shifted. Can you decode what they're saying? The enemy uses a classic 13-step rotation.",
    cipherLabel: "INTERCEPTED MESSAGE",
    cipher: "GUR CNFFJBEQ VF: TERRA_YVTUG",
    hint_context: "Caesar cipher with ROT13 (shift of 13). Each letter is shifted 13 positions in the alphabet.",
    answer: "GREEN_LIGHT",
    explanation: "ROT13 cipher â€” each letter shifted by 13. Gâ†’T, Uâ†’H, Râ†’E, etc."
  },
  {
    id: 2, title: "Binary Ghost", diff: "easy", points: 150,
    tags: ["BINARY", "ENCODING"],
    desc: "A ghost left a message in the machine. Every byte tells a story â€” if you can read the language of computers.",
    cipherLabel: "BINARY TRANSMISSION",
    cipher: "01000110 01001100 01000001 01000111 00111010 01001000 01000001 01000011 01001011 01000101 01000100",
    hint_context: "Binary to ASCII conversion. Each 8-bit group represents one ASCII character. Convert each byte to decimal, then to its ASCII character.",
    answer: "HACKED",
    explanation: "Binary decoded to ASCII: FLAG:HACKED â€” the answer is HACKED"
  },
  {
    id: 3, title: "The Alchemist's Code", diff: "medium", points: 200,
    tags: ["BASE64", "ENCODING"],
    desc: "Medieval alchemists hid secrets in plain sight. This modern alchemist encoded a secret using a method common in web tokens and APIs. Decode it.",
    cipherLabel: "ENCODED SECRET",
    cipher: "U2VjcmV0S2V5OiBTSEFET1dfV0FMSw==",
    hint_context: "Base64 encoding. Decode the Base64 string to find the hidden text. The answer is the key value after the colon.",
    answer: "SHADOW_WALK",
    explanation: "Base64 decoded: 'SecretKey: SHADOW_WALK' â€” answer is SHADOW_WALK"
  },
  {
    id: 4, title: "VigenÃ¨re Vault", diff: "medium", points: 250,
    tags: ["VIGENÃˆRE", "POLYALPHABETIC"],
    desc: "An encrypted vault protects the flag. The key is hidden in plain sight â€” it's what every hacker needs: good intel. The key is the word INTEL.",
    cipherLabel: "VAULT CIPHER (Key: INTEL)",
    cipher: "BHRGK_APVNB",
    hint_context: "VigenÃ¨re cipher with key INTEL. For each letter, subtract the key letter's position (I=8, N=13, T=19, E=4, L=11) from the cipher letter. Use modulo 26.",
    answer: "VAULT_OPEN",
    explanation: "VigenÃ¨re with key INTEL: B-I=T, H-N=U, R-T=Y... decodes to VAULT_OPEN"
  },
  {
    id: 5, title: "Prime Conspiracy", diff: "hard", points: 300,
    tags: ["MATHEMATICS", "PRIMES"],
    desc: "The shadow organization communicates using prime number positions. Each number represents the Nth prime. Decode the sequence to find the passphrase. Use primes: 2,3,5,7,11,13,17,19,23...",
    cipherLabel: "PRIME SEQUENCE",
    cipher: "4 Â· 1 Â· 9 Â· 7 Â· 4 Â· 8 Â· 1 Â· 14",
    hint_context: "Each number N maps to the Nth prime. 1st prime=2(B), 2nd=3(C), 3rd=5(E), 4th=7(G), 5th=11(K), 6th=13(M), 7th=17(Q), 8th=19(S), 9th=23(W)... then convert primes to letters where A=2, B=3, C=5...",
    answer: "DARKNET",
    explanation: "Sequence 4,1,9,7,4,8,1,14 â†’ primes 7,2,23,17,7,19,2,43 â†’ D,A,R,K,N,E,T = DARKNET"
  },
  {
    id: 6, title: "Zero Day", diff: "hard", points: 400,
    tags: ["XOR", "HEX", "CRYPTO"],
    desc: "Elite level. The final cipher uses XOR encryption â€” the backbone of modern cryptography. The hex-encoded ciphertext was XORed with single-byte key 0x41. Decrypt it.",
    cipherLabel: "HEX CIPHERTEXT (XOR key: 0x41 = 'A')",
    cipher: "12 00 16 14 1D 05 1B 12 19",
    hint_context: "XOR each hex byte with 0x41 (decimal 65, letter A). For example: 0x12 XOR 0x41 = 0x53 = 'S'. Do this for each byte and convert to ASCII.",
    answer: "SUPERSTAR",
    explanation: "Each byte XORed with 0x41: 0x12^0x41=S, 0x00^0x41=A... = SUPERSTAR"
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let playerName = '';
let score = 0;
let solved = new Set();
let currentChallenge = null;
let terminalLines = [];

// Fake leaderboard
const fakeBoard = [
  { name: 'n3ur0_h4ck', solved: 6, score: 1320 },
  { name: 'voidrunner', solved: 5, score: 1050 },
  { name: 'xpl0it_99',  solved: 4, score: 850  },
  { name: 'shadow_key',  solved: 3, score: 600  },
  { name: 'c0d3_witch',  solved: 2, score: 350  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TERMINAL LOGGER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function log(msg, type='') {
  const body = document.getElementById('terminal-body');
  const line = document.createElement('div');
  line.className = `t-line ${type}`;
  const time = new Date().toLocaleTimeString('en-GB',{hour12:false});
  line.textContent = `[${time}] ${msg}`;
  body.appendChild(line);
  body.scrollTop = body.scrollHeight;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ENTER ARENA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enterArena() {
  const val = document.getElementById('callsign-input').value.trim();
  if (!val) { document.getElementById('callsign-input').focus(); return; }
  playerName = val.toUpperCase();
  document.getElementById('intro-screen').classList.remove('active');
  document.getElementById('arena-screen').classList.add('active');
  document.getElementById('header-callsign').textContent = '> ' + playerName;
  renderChallenges();
  renderScoreboard();
  log(`Agent ${playerName} has entered the arena.`, 'success');
  log('6 challenges awaiting. Good luck.', 'info');
}

document.getElementById('callsign-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') enterArena();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER CHALLENGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderChallenges() {
  const grid = document.getElementById('challenges-grid');
  grid.innerHTML = CHALLENGES.map(ch => `
    <div class="challenge-card ${ch.diff} ${solved.has(ch.id)?'solved':''}" onclick="openChallenge(${ch.id})">
      <div class="ch-header">
        <div class="ch-title">${ch.title}</div>
        <div class="ch-points">${ch.points}</div>
      </div>
      <div style="margin-bottom:10px;"><span class="diff-badge">${ch.diff}</span></div>
      <div class="ch-desc">${ch.desc}</div>
      <div class="ch-tags">${ch.tags.map(t=>`<span class="ch-tag">${t}</span>`).join('')}</div>
    </div>
  `).join('');
  updateProgress();
}

function updateProgress() {
  const pct = Math.round((solved.size / CHALLENGES.length) * 100);
  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('progress-pct').textContent = pct + '%';
  document.getElementById('progress-text').textContent = `MISSION PROGRESS Â· ${solved.size}/${CHALLENGES.length} SOLVED`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OPEN CHALLENGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openChallenge(id) {
  currentChallenge = CHALLENGES.find(c => c.id === id);
  const ch = currentChallenge;

  document.getElementById('modal-title').textContent = ch.title;
  document.getElementById('modal-meta').innerHTML = `
    <span class="diff-badge ${ch.diff}">${ch.diff}</span>
    <span style="font-family:var(--mono);font-size:12px;color:var(--muted);">${ch.points} pts</span>
  `;
  document.getElementById('modal-desc').textContent = ch.desc;
  document.getElementById('cipher-label').textContent = ch.cipherLabel;
  document.getElementById('modal-cipher').textContent = ch.cipher;

  const input = document.getElementById('answer-input');
  input.value = '';
  input.className = 'answer-input';
  input.disabled = solved.has(ch.id);

  document.getElementById('submit-btn').disabled = solved.has(ch.id);
  document.getElementById('feedback').className = 'feedback';
  document.getElementById('feedback').textContent = '';
  document.getElementById('hint-box').className = 'hint-box';
  document.getElementById('hint-box').textContent = '';
  document.getElementById('hint-btn').disabled = false;

  if (solved.has(ch.id)) {
    const fb = document.getElementById('feedback');
    fb.className = 'feedback correct show';
    fb.textContent = 'âœ“ You already solved this challenge!';
  }

  document.getElementById('modal-overlay').classList.add('open');
  if (!solved.has(ch.id)) input.focus();
  log(`Opened challenge: ${ch.title}`, 'cmd');
}

function closeModal(e) {
  if (e.target === document.getElementById('modal-overlay')) closeModalDirect();
}
function closeModalDirect() {
  document.getElementById('modal-overlay').classList.remove('open');
  currentChallenge = null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT ANSWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function submitAnswer() {
  const input = document.getElementById('answer-input');
  const answer = input.value.trim().toUpperCase().replace(/\s+/g,'_');
  const fb = document.getElementById('feedback');

  if (!answer) return;

  const correct = answer === currentChallenge.answer.toUpperCase();

  if (correct) {
    if (!solved.has(currentChallenge.id)) {
      solved.add(currentChallenge.id);
      score += currentChallenge.points;
      document.getElementById('header-score').textContent = score;
      log(`âœ“ SOLVED: ${currentChallenge.title} +${currentChallenge.points}pts`, 'success');
    }
    input.className = 'answer-input correct';
    fb.className = 'feedback correct show';
    fb.textContent = `âœ“ CORRECT! ${currentChallenge.explanation}`;
    document.getElementById('submit-btn').disabled = true;
    input.disabled = true;
    renderChallenges();
    renderScoreboard();
    updateProgress();
  } else {
    input.className = 'answer-input wrong';
    fb.className = 'feedback wrong show';
    fb.textContent = 'âœ— WRONG. Try again.';
    log(`âœ— Wrong answer on: ${currentChallenge.title}`, 'error');
    setTimeout(() => input.className = 'answer-input', 500);
  }
}

document.getElementById('answer-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') submitAnswer();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AI HINT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function getHint() {
  const btn = document.getElementById('hint-btn');
  const box = document.getElementById('hint-box');
  btn.disabled = true;
  box.className = 'hint-box show';
  box.innerHTML = '<span class="hint-loading">âš¡ QUERYING AI...</span>';
  log('Requesting AI hint...', 'warn');

  // Deduct points
  score = Math.max(0, score - 10);
  document.getElementById('header-score').textContent = score;

  try {
    const res = await fetch('https://threatscan-server-production.up.railway.app/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'DeepSeek-V3',
        question: `You are a CTF challenge hint system. Give a helpful hint (NOT the answer) for this challenge:\n\nChallenge: ${currentChallenge.title}\nContext: ${currentChallenge.hint_context}\n\nGive ONE clear hint in 2-3 sentences that guides the player without revealing the answer directly. Be encouraging.`
      })
    });

    const data = await res.json();
    if (data.result) {
      box.innerHTML = `<span style="color:var(--warn);font-family:var(--mono);font-size:10px;letter-spacing:0.1em;">âš¡ AI HINT</span><br><br>${data.result}`;
      log('AI hint received.', 'info');
    } else {
      // Fallback hint
      box.innerHTML = `<span style="color:var(--warn);font-family:var(--mono);font-size:10px;">âš¡ HINT</span><br><br>${currentChallenge.hint_context}`;
    }
  } catch {
    box.innerHTML = `<span style="color:var(--warn);font-family:var(--mono);font-size:10px;">âš¡ HINT</span><br><br>${currentChallenge.hint_context}`;
    log('Used offline hint (AI unavailable).', 'warn');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCOREBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderScoreboard() {
  const list = document.getElementById('scoreboard-list');

  // Insert player into board
  const board = [...fakeBoard];
  const existing = board.findIndex(e => e.name === playerName);
  if (existing >= 0) board.splice(existing, 1);
  board.push({ name: playerName, solved: solved.size, score, isYou: true });
  board.sort((a, b) => b.score - a.score);

  if (board.every(e => e.score === 0)) {
    list.innerHTML = '<div class="empty-board">No scores yet. Start solving challenges!</div>';
    return;
  }

  const rankIcons = ['gold','silver','bronze'];
  list.innerHTML = board.map((p, i) => `
    <div class="score-row ${p.isYou ? 'you' : ''}">
      <span class="rank ${rankIcons[i]||''}">${i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':'#'+(i+1)}</span>
      <span class="sb-name">${p.name}${p.isYou?' <span style="font-size:11px;color:var(--accent);font-family:var(--mono)">[YOU]</span>':''}</span>
      <span class="sb-solved">${p.solved}/${CHALLENGES.length} solved</span>
      <span class="sb-score">${p.score}</span>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TAB SWITCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name, el) {
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('tab-' + name).classList.add('active');
  if (name === 'scoreboard') renderScoreboard();
}
</script>
</body>
</html>
